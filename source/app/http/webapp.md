# Webアプリケーションについて

WWW(World Wide Web)において、もともとは単純なHTMLによる静的なページが主流でしたが、現在では動的なコンテンツが大半となっております。
これらがどのように実現されているかについてを、簡単に解説しておきましょう。

## プラグイン

初期のWebブラウザでは、表現力を補うための方法としてプラグインが広く使われていました。現在でも少しは残っていると思いますがほぼ廃れている状態です。
プラグインは、Webブラウザに追加するソフトウェアコンポーネントで、インストールしたコンポーネントによって機能が提供されるというものでした。

### Adobe Flash Player

Adobe社により開発されたプラグイン[^afp]で、アニメーションやインタラクティブなコンテンツをWebブラウザ上で表示するために広く使われていました。プラグインはブラウザの表示空間内に矩形領域を確保し、その中でFlashコンテンツと呼ばれるリッチコンテンツが動作しました。

Flashコンテンツは ActionScript で記述され、アニメーション、ゲーム、ビデオプレーヤーなどのインタラクティブな要素を提供しました。Flash は当初 NPAPI ベースで提供されていましたが、後に Chrome 向けに Pepper/PPAPI 版も用意されました。とはいえ、ブラウザ外の独自ランタイムで描画や UI を行うためページ全体の一貫性やアクセシビリティに課題があり、加えてセキュリティ上の脆弱性が繰り返し報告されました。

HTML5/CSS/JavaScript の進化やスマートフォンの普及(Apple の iOS がプラグインをサポートしなかったことなど)を受けて、主要ブラウザはプラグイン実行を制限するようになりました。結果として Adobe は 2020 年末で Flash の公式サポートを終了しました。

[^afp]: 正確には Macromedia 社が開発していた製品を Adobe 社が買収して引き継いだものです。

### Microsoft Silverlight

MicrosoftもFlashに負けじと作られていたのがSilverlightです。
.NET Frameworkをベースにしており、デスクトップアプリなどの開発の知識をそのままWebアプリケーションとして持ち込めるなどの利点(?)もありましたが、Flash問題と同様にスマートフォンでの非対応が痛手となり、普及はほとんどしていない状態でした。結局2021年10月でサポート終了となっています。

### Javaアプレット

Javaアプレットは、ブラウザ上で Java 仮想マシンを利用してバイトコードを実行する仕組みでした。かつてはリッチクライアント的な機能をブラウザにもたらしましたが、多くはブラウザ側のプラグインモデル (NPAPI など) に依存していたため、ブラウザベンダーがプラグインを廃止すると実行できなくなりました。

また、セキュリティ上の懸念や起動性能の問題も普及の妨げになりました。併せて、Java Web Start (JNLP) のようにブラウザ外で Java アプリを起動する仕組みも存在しましたが、これも次第に利用されなくなりました。
### ActiveX

ActiveX は Windows に特化したコンポーネント技術で、COM ベースのコントロール (DLL 等) を通じてブラウザ上でネイティブコードを実行する仕組みでした。高い権限で OS の機能にアクセスできる一方、深刻なセキュリティリスクやプラットフォーム依存 (主に Windows / Internet Explorer) が問題となり、一般的なブラウザではサポートが廃止されました。

企業内システムなどで長く使われた例はあるものの、Internet Explorer の後継ブラウザや最新の Web プラットフォームでは ActiveX は利用できません。実運用では Windows Update のように ActiveX を使った仕組みが存在した歴史がありますが、現在は専用アプリや OS 側の別の仕組みに置き換えられています。

## スクリプト言語

現在、WebアプリケーションはJavaScriptというブラウザ上で唯一使えるスクリプト言語を使って実現されているのがほとんどです。
JavaScriptは、HTMLとCSSとともにWebの標準技術の一つであり、動的なコンテンツやインタラクティブな機能を提供するために広く使用されています。
JavaScriptは、ブラウザ内で直接実行されるため、ユーザーの操作に即座に反応することができます。また、Ajax(Asynchronous JavaScript and XML)技術を使用することで、ページ全体を再読み込みせずにサーバーと通信し、部分的にコンテンツを更新することも可能です。

```{note}
JavaScriptは、1995年にNetscape社によって開発され、その後ECMA Internationalによって標準化されました。現在では、Node.jsなどのサーバーサイド環境でも使用されており、フルスタックな開発が可能です。
```

### TypeScriptなどのAltJS

JavaScriptは動的型付け言語であり、柔軟性が高い一方で、大規模なアプリケーション開発においては型安全性やコードの可読性・保守性に課題があることも指摘されてきました。
これを補うために、TypeScriptのようなスーパーセット言語が登場しました[^AltJS]。TypeScriptは、JavaScriptに静的型付けやクラスベースのオブジェクト指向などの機能を追加した言語であり、コードの品質向上や開発効率の向上に寄与しています。TypeScriptで書かれたコードは、コンパイル時にJavaScriptに変換され、ブラウザで実行されます。
なお、JavaScriptへの変換は言語から言語への「翻訳」にあたることから、トランスパイル(translate + compile)と呼ばれることもあります。TypeScriptとして正しいコードでないとJavaScriptに変換できないため、一種のLint(静的コード解析)の役割も兼ねています。


[^AltJS]: このような言語としては、他にCoffeeScriptやDartなどもありますが、TypeScriptが最も広く使われています。

### WebAssembly

```{note}
これを「スクリプト言語」の枠で扱うのは少しおかしいかもしれませんが、JavaScriptから呼び出されることが前提の仕組みのため、この枠で解説します。
```

WebAssembly(略称: wasm)は、ブラウザ上で高性能なコードを実行するためのバイナリ形式の命令セットアーキテクチャです。C/C++やRustなどの言語で書かれたコードをコンパイルして生成され、JavaScriptから呼び出して(もしくは呼び出されて)利用します。
実際にはJavaScriptのランタイム中にWASMのエンジンが用意されており、同時並行的に呼び出されるという構造になっています。
非常に高速に動作するため、ゲームエンジンや画像処理、科学計算などの高負荷な処理に適しています。また、WASMはサンドボックス化されており、セキュリティ上のリスクを低減しています。

## CGI(Common Gateway Interface)

CGIは、Webサーバーが外部のプログラムを呼び出すための仕組み(規約)です。CGIを使用することで、Webサーバーは動的なコンテンツの生成をプログラムから行うことができるようになりました。

```{mermaid}
sequenceDiagram
    participant Client as クライアント
    participant Server as Webサーバー
    participant CGI as CGIプログラム

    Client->>Server: HTTPリクエスト
    Server->>CGI: CGIプログラムの起動 + 環境変数設定
    CGI->>CGI: リクエスト処理
    CGI-->>Server: HTTPレスポンス(標準出力)
    Server-->>Client: HTTPレスポンス
```

CGIによるプログラムは、ルール(入出力のとりきめ)を守れば言語を問わずに実装できるものの、テキスト処理が多いということからスクリプト言語が広く使われることになり、Perlから始まり、現在でも広く使われているPythonやRubyが普及する一因となりました。
その反面、CGIプログラムはリクエストごとにプロセスが生成されるため、オーバーヘッドが大きく、パフォーマンスの問題がありました。このため、より効率的な仕組みが求められるようになりました。

### PHP

PHP言語は、当初からWeb上での利用(サーバーサイドでの処理)を前提としていました。
当初は他の言語と同様にCGIとして動作していましたが、処理性能というよりは起動処理やメモリの使用量などの問題があることから、Apache HTTP Serverのモジュールとして組み込めるようにmod_phpが開発されました。
これにより、PHPの実行は他の言語に比べて足回りが軽くなりました。
更にPHP自体の高速化が継続して進められており、現在のWebアプリケーションの主要な一角として確立しています。

```{note}
このムーブメントは、他の言語に対しても広まりがあり、Perlに対するmod_perl、Pythonに対するmod_python、Rubyに対するmod_rubyなどのモジュールが開発されました。ただし、これらはPHPほどの普及には至っていません。
```

### FastCGI

FastCGIは、CGIのパフォーマンス問題を解決するために開発されたプロトコルです。FastCGIでは、CGIプログラムが常駐プロセスとして動作し、複数のリクエストを処理できるようになっています。これにより、プロセスの起動と終了のオーバーヘッドが削減され、パフォーマンスが向上しました。ただし、FastCGIに適合するようにプログラムの書き換えが必要という問題もあります。

FastCGIは、Webサーバーとアプリケーションサーバー間の通信にソケットを使用し、リクエストとレスポンスのデータを効率的にやり取りします。これにより、Webサーバーは複数のアプリケーションサーバーにリクエストを分散させることができ、スケーラビリティが向上します。

PHP言語も、mod_phpによりApache HTTP Server依存になるという状況もありましたが、FastCGIを利用することでWebサーバーから独立した形で動作できるようになりました[^fpm]。
これにより、Nginxなどの他のWebサーバーでもPHPを利用できるようになり、PHPの普及に寄与しました。

[^fpm]: PHP-FPM(PHP FastCGI Process Manager)