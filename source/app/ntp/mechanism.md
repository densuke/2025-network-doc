# NTPとは

NTP(Network Time Protocol)は、インターネット上でコンピュータの時刻を正確に同期させるためのプロトコルです。
NTPは、1985年に開発され、その後も改良が続けられています。NTPは、階層構造を持つサーバー群を利用して、正確な時刻情報を提供します。

NTPは、主に以下のような仕組みで動作します。
1. **階層構造**: NTPサーバーは、階層構造を持っています。最上位のサーバーは「ストラタム0」と呼ばれ、原子時計やGPSなどの高精度な時刻源に接続されています。次に「ストラタム1」サーバーがあり、これらはストラタム0サーバーから時刻情報を取得します。さらに下位のストラタム2、ストラタム3と続きます。
2. **時刻同期**: NTPクライアントは、指定のNTPサーバーに対して「現在の時刻情報」をリクエストします。NTPサーバーは、クライアントに対して正確な時刻情報を返します。クライアントは、受け取った時刻情報を基に、自身のシステムクロックを調整します。
3. **補正アルゴリズム**: NTPは、ネットワーク遅延やジッターを考慮した補正アルゴリズムを使用しています。これにより、クライアントは正確な時刻を取得することができます。

## 回線速度について

- 大雑把に考えて、NTPクライアントとサーバーが別のホストである以上、通信遅延が微妙に発生します
- 例えば片道30msの遅延があると仮定してみましょう
- クライアントがサーバーにリクエストを送信し、サーバーが応答を返すまでに60msの往復遅延が発生します
- 片道の時間が往復それぞれ同じ(往路30ms、復路30ms)と仮定すると、クライアントはサーバーから受け取った時刻情報に30msを加算することで、より正確な時刻を得ることができます
- しかし、実際のネットワーク環境では、往路と復路の遅延が異なる場合があります。このため、NTPは複数回のリクエストと応答を行い、平均的な遅延を計算することで、より正確な補正を行います
- つまり、NTPでの補正は、完全に正確なものとは言えず、あくまで近似的なものであることに注意が必要です

## ジッターについて

- ジッターとは、ネットワーク通信における遅延のばらつきを指します
- 例えば、ある瞬間に30msの遅延が発生し、次の瞬間には50msの遅延が発生する場合、これがジッターです
- NTPは、複数回のリクエストと応答を行い、ジッターを考慮した補正を行います
- これにより、クライアントはより安定した時刻情報を取得することができます

## NTPの精度について

NTPは、厳密にミリ秒まで揃えられるというものではなく、前後に1秒程度の遅延は発生していると考えていいでしょう。
この程度の誤差であれば、多くのアプリケーションにとっては問題になることはありません。
