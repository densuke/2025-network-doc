# 無線通信

私たちが現在広く使っている媒体として、無線通信があります。
大きく分ければ、3Gや4G、LTEや5Gといった携帯電話のものと、Wi-FiやBluetoothといった無線LANのものがあります。

## 電波法

無線通信は、電波の特性により空気中に信号が満ち満ちてしまうため、場合によって互いに干渉したり、障害が発生する恐れがあります。
そのため、電波法という法律で、無線通信の周波数帯域を規制しています。

大雑把には

- 電波には『自由に使ってよい』範囲と『届出してから使ってね』という範囲が存在します
- 自由に使ってよい範囲は、周波数帯域が狭く、出力も小さいもの
- もしくは歴史的経緯で既に使われていたようなものを合法化するために割り当てたものがある
- 隣接する周波数帯は、互いに干渉することで電波の質が落ちるので注意が必要

実際に日本で使われるWi-Fi絡みとしては、2つないし3つの帯域があります。

### 2.4GHz帯

- 2400MHzから2483.5MHzまでの範囲
- ISM(Industrial, Scientific and Medical)バンドに属しており、様々な機器が既に使っており、無届けでも利用可能
    - 電子レンジなども使っているので、いちいち届出とか出してると面倒すぎるという側面もある
    - ただし出力制限はもちろんあるよ
- 11b/g/n/ac/axが使える

### 5GHz帯

- W52: 5150MHzから5250MHzまで
    - 屋内での利用のみ
- W53: 5250MHzから5350MHzまで
    - 屋内での利用のみ
    - 気象レーダー等でも使っている領域のため、そういったものを検出したときに利用を止めるDFSが必要
- W56: 5470MHzから5725MHzまで
    - DFSが必要
- 11a/n/ac/axが使える

### 6GHz帯
- 5925MHzから7125MHzまで
  - ただし日本では5925〜6425MHzまで
  - 6425〜7125MHzは、今後開放される見込み

### 雑な電波の性質

- 周波数が低い方が直進性が強く、貫通性が高いです。また、障害物に対して回り込むなどの特性があります。
  - 携帯電話で俗に言われる『プラチナバンド』は700MHz帯で、障害物に強い特性があります。
  - ただし周波数が低いということは単位時間あたりに乗せられる情報量が(単純には)少ないと考えられます。
- 周波数が高い方が直進性が弱く、貫通性が低いです。また、障害物に対して回り込むことができません。
  - 5GHz帯は、2.4GHz帯に比べて直進性が弱く、貫通性が低いです。
  - ただし周波数が高いということは単位時間あたりに乗せられる情報量が(単純には)多いと考えられます。
- そのため、5GHz帯は、2.4GHz帯に比べて通信速度が速くなりますが、障害物に対して弱くなります。

家の中での運用については、部屋をまたげるかどうかは考慮すべきものです。
アクセスポイントのある部屋では5GHzや6GHzを使い、部屋をまたぐ場合は2.4GHzを使うといった運用が考えられます。

### 技適マーク

- 日本国内で無線通信を行うためには、技術基準適合証明を受けた機器を使用する必要があります。
- 技適マークは、技術基準適合証明を受けたことを示すマークで、無線通信機器に表示されています。
- 技適マークがない機器を使用すると、電波法に違反することになります。

輸入品の無線機器においては、技適マークのない機器を使用することは法律に抵触する可能性があります。
ただし、検証目的の場合は届出を行う必要で一定期間使用することが可能です([技適未取得機器を用いた実験等の特例制度](https://www.tele.soumu.go.jp/j/sys/others/exp-sp/))。

## Wi-Fi

- Wi-Fiは、無線通信を使用してデータを送受信するための技術で、主に家庭やオフィスなどのローカルエリアネットワーク(LAN)で使用されます。
- Wi-Fiは、無線LANの一種で、IEEE 802.11規格に基づいています。
- 現状では、2.4GHz帯と5GHz帯の周波数帯域を使用しています(一部6GHz帯)。

歴史的な流れで無線の規格が登場し、徐々に進化しています。
そして信号に帯するセキュリティなども絡んできます。

また、通信を行う際に信号に帯する帯域分けが行われており、チャネルと呼ばれています。
チャネル幅はHz(ヘルツ)で表され、周波数帯域の幅を示します(20MHz, 40MHz, 80MHz, 160MHz)。

### Wi-Fiの規格

- 無印の802.11
    - 1997年に策定された最初のWi-Fi規格で、最大通信速度は2Mbps。
    - 2.4GHz帯を使用。
- 802.11a
    - 1999年に策定された規格で、最大通信速度は54Mbps。
    - 5GHz帯を使用。
- 802.11b
    - 1999年に策定された規格で、最大通信速度は11Mbps。
    - 2.4GHz帯を使用。
- 802.11g
    - 2003年に策定された規格で、最大通信速度は54Mbps。
    - 2.4GHz帯を使用。
- 802.11n
    - 2007年に策定された規格で、最大通信速度は600Mbps。
    - 2.4GHz帯と5GHz帯の両方を使用。
    - MIMO(Multiple Input Multiple Output)技術を使用して、複数のアンテナを使用して通信速度を向上させることができます。
    - a/b/g/nまでをWi-Fi 4としてまとめて呼ぶこともあります。
- 802.11ac
    - 2013年に策定された規格で、最大通信速度は6.93Gbps。
    - 5GHz帯を使用。
    - MU-MIMO(Multi-User Multiple Input Multiple Output)技術を使用して、複数のデバイスと同時に通信することができます。
- 802.11ax
    - 2019年に策定された規格で、最大通信速度は9.6Gbps。
    - 2.4GHz帯と5GHz帯の両方を使用。6GHz帯も使用可能。
    - OFDMA(Orthogonal Frequency Division Multiple Access)技術を使用して、複数のデバイスと同時に通信することができます。
    - Wi-Fi 6(2019)/6E(2021)としても知られています。
- 802.11be
    - 2024年に策定の規格で、最大通信速度は46Gbps。
    - 2.4GHz帯、5GHz帯、6GHz帯のすべてを使用。
    - Wi-Fi 7としても知られています。

### Wi-Fiのセキュリティ

電波の特性上、無線通信は周囲に同じ情報を載せた信号(電波)を飛ばすため、受信設備があれば他人でも受信できてしまいます。
これを防ぐためにセキュリティが必要となりました。

```{note}
逆にこのことを利用して、あえて公開しているような無線もあります。
代表的なものとして、航空無線や、アマチュア無線などがあります。

ただし公開されており傍受(聞くことができる)できても、それを漏らしたり利用することは、
電波法における『通信の秘密の保護』に違反する行為になり得るので注意が必要です。
```

- WEP(Wired Equivalent Privacy)
    - 1997年に策定された最初のWi-Fiセキュリティ規格で、RC4暗号を使用。
    - セキュリティが弱く、現在ではほとんど使用されていません。
- WPA(Wi-Fi Protected Access)
    - 2003年に策定されたWi-Fiセキュリティ規格で、TKIP(Temporal Key Integrity Protocol)を使用。
    - 本来は早めにリリースさせたかった(WEPを潰すため)が、制定が遅れてしまったという経緯がある
    - 当初のWPAはそういう意味ではつなぎのようなもの(WPA1とでも言えばいいかな)
    - WPA2(Wi-Fi Protected Access 2)
        - 2004年に策定されたWi-Fiセキュリティ規格で、AES(Advanced Encryption Standard)を使用。
        - WPAの後継規格で、より強力なセキュリティを提供します。
        - WPA2は、現在のWi-Fiセキュリティの標準規格ですが、WPA3が策定されたため、今後はWPA3が主流になると考えられます。
    - WPA3(Wi-Fi Protected Access 3)
        - 2018年に策定されたWi-Fiセキュリティ規格で、より強力なセキュリティを提供します。
        - WPA2の後継規格で、より強力なセキュリティを提供します。
        - WPA3は、現在のWi-Fiセキュリティの標準規格です。
        - WPA3は、WPA2と互換性がありますが、WPA2のセキュリティを強化しています。

### アクセスポイント

Wi-Fiでは、接続先として『アクセスポイント』というものを利用します(略してAP)。
ハブみたいな感じです。

アクセスポイント名はSSID(Supplemental Service Set Identifier)と呼ばれ、ネットワークの名前を示します。
同じ名前で複数の名称を共有することは可能で、認証が通れば適宜乗り換える(電波の強さなどで)場合もあります。

- 事前共有型(PSK; Pre-shared Key)
    - 普段使っている『アクセスポイント名とパスワード』の認証方式
    - WPA/WPA2/WPA3で使用される認証方式で、事前に共有されたパスワードを使用して認証します。
    - ただし、パスワードが漏洩すると、他の人も接続できてしまうため、注意が必要です。
- オープンシステム認証
    - 認証を行わない方式で、誰でも接続できるようにすることができます。
    - セキュリティが弱いため、公共の場などでは使用しない方が良いです。
- WPA/WPA2/WPA3エンタープライズ
    - 企業や組織向けの認証方式で、RADIUSサーバーを使用して認証します。
    - ユーザーごとに異なる認証情報を使用するため、セキュリティが強化されます。
        - アクセスポイント名+ユーザー名+パスワード
    - ただし、設定が複雑になるため、一般的な家庭用ルーターではあまり使用されません。


## おまけ: TKIPとAES
- TKIP(Temporal Key Integrity Protocol)
    - WPAで使用される暗号化プロトコルで、RC4暗号を使用。
    - TKIPは、WEPのセキュリティを強化するために開発されましたが、現在ではセキュリティが弱くなっています。
- AES(Advanced Encryption Standard)
    - WPA2で使用される暗号化プロトコルで、より強力なセキュリティを提供します。
    - AESは、米国政府が採用した暗号化標準で、現在では広く使用されています。

AESはその制定方式が地味に面白い

- AESは特定のものをさすものでもなかった
- 1997年に米国政府が新しい暗号化標準を策定するためのコンペティションを開催
    - その過程で様々なアルゴリズムが提案された
    - それらはオープンなものとして世界中の数学者が評価していった
    - 最終的に5つのファイナリストが残った
        - MARS
        - RC6
        - Serpent
        - Twofish
        - Rijndael
    - その中からRijndaelが選ばれた -> AESと呼ばれるようになった
- 評価基準も面白い
    - セキュリティ
    - 処理速度
    - 実装の容易さ(プログラム的なものとハードウェア的なもの)
    - メモリ要件
    - 鍵長の柔軟性


## Bluetooth

- Bluetoothは、無線通信を使用してデータを送受信するための技術で、主に短距離通信に使用されます。
- 2.4GHz帯を使用しています。
- 主にホストを介したデバイス間の通信に使用されます。
- Bluetoothは、無線LANと比較して通信距離が短く、消費電力が少ないため、主にモバイルデバイスやIoTデバイスなどで使用されます。

大雑把に10m程度の距離での通信を想定していますが、環境が許せばもう少し長距離でも繋がったりします。
実際の用途としては、スマホやパソコンなどのホストを中心として、以下のような機器を接続しています。
この際にカテゴリ毎に『プロファイル』と呼ばれるルールが制定されており、それを守ることで通信の方式をある程度単純化しています。

- **HID(Human Interface Device)**
    - キーボードやマウスなどの人間が操作するためのデバイス
    - HIDプロファイルを使用して、ホストとデバイス間でデータを送受信します。
- **A2DP(Advanced Audio Distribution Profile)**
    - 音声データを送受信するためのプロファイル
    - ステレオ音声を高品質で伝送することができます。
- **AVRCP(Audio/Video Remote Control Profile)**
    - 音声や映像のリモートコントロールを行うためのプロファイル
    - 音楽プレーヤーやテレビなどのデバイスをリモートで操作することができます。
- HFP(Hands-Free Profile)
    - ハンズフリー通話を行うためのプロファイル
    - スマートフォンとBluetoothヘッドセットなどのデバイス間で通話を行うことができます。
- HSP(Headset Profile)
    - ヘッドセットを使用して音声通話を行うためのプロファイル
    - スマートフォンとBluetoothヘッドセットなどのデバイス間で通話を行うことができます。
- PAN(Personal Area Network)
    - パーソナルエリアネットワークを構築するためのプロファイル
    - Bluetoothデバイス同士でネットワークを構築することができます。

いろいろあるので、Bluetoothのプロファイルについては[こちら](https://ja.wikipedia.org/wiki/Bluetooth%E3%83%97%E3%83%AD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%B8%80%E8%A6%A7)を参照してください。

2.4GHz帯(ISM)を使っていますが、その関係でWi-Fiと干渉することがあります。
ただし通信方式の違いで干渉をおさえるようになっています。

```{note}
同じISMバンドを使うものとして電子レンジがあります。
電子レンジを使うとBluetoothの通信が途切れたり、Wi-Fiの通信が途切れたりすることがあります。

そういう意味ではWi-Fiは5GHz帯を使うようにしたほうが家の中での干渉を減らせる可能性は高くなります。
```

