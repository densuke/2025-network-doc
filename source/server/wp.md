# Wordpressの導入とアーカイブ操作

LAMPスタックの基本構造ができたので、いよいよPHPを使うアプリケーションの代表例であるWordpressを導入してみましょう。
WordpressはPHPで書かれたCMS(Contents Management System)であり、ブログやWebサイトの構築に広く利用されています。PHPアプリケーション利用において、Wordpressは非常に人気があり、多くのユーザーに支持されています。

- [Wordpress公式サイト](https://ja.wordpress.org/) ※日本語版ページ
- [ダウンロードのリンク](https://ja.wordpress.org/download/)

Linuxで利用するさいに少し注意が必要で、単純に『青いボタン』っぽいものをクリックすると、zip形式のアーカイブがダウンロードされてしまいます(しかもブラウザ上で!)。
Linuxではtar.gz形式のアーカイブを使うことが多いので、そちらのダウンロードへ進みます。そのためにはダウンロードボタンの下にある「リリース」というリンクで進めてください。

```{figure} images/wp-dl-release.png
:width: 60%

Wordpressのダウンロードページ(リリースへ行くこと)
```

本原稿執筆時点でのリリースバージョンは6.9となっており、この一覧にある "tar.gz" というリンクを**右クリックして「リンクのアドレスをコピー」**してください。

## Linux上でのダウンロード操作

Linux上でファイルをダウンロードするには、主に2つのコマンドが使われています。

- `wget`: 古くかあるもので、シンプルにURLからダウンロードしてローカルに保存します。
- `curl`: より多機能で、HTTPリクエストの詳細な制御が可能です。ダウンロード以外にも様々な用途に使えます。
  - Windows環境でも移植されたcurlが利用可能です[^curlwin]。

[^curlwin]: Windows 10以降では標準でcurlが利用可能です。ただしPowerShellでエミュレートするコードが残っており、利用するPowerShell環境によりそちらが動いてしまうことになります(名前を模倣しただけの全くの別物)。そのため、確実にコマンドを実行するために `curl.exe` と入力して実行する必要があるかもしれません。この資料ではあくまでVM上のLinux環境を想定しているため、この配慮は行われません。

今回はアーカイブ操作の確認ということで、一時的なディレクトリ上で作業をしてみましょう。
今使っているターミナルとは別のターミナルを開いて行ってください。

```bash
mkdir /tmp/wp
cd /tmp/wp
wget https://ja.wordpress.org/latest-ja.tar.gz #コピーしたリンクを貼り付ける(右クリック)
ls -l # ファイルのチェック
```

無事ダウンロードはできたかと思います。

## アーカイブの展開について

tar.gz形式のアーカイブ操作は、`tar`コマンドで行います。
一般的なLinuxのコマンドからすると、少しクセがあります。

```bash
tar tvzf latest-ja.tar.gz # アーカイブの中身を確認
tar xvzf latest-ja.tar.gz # アーカイブの展開
ls -l # 展開されたディレクトリの確認(ディレクトリが追加されるはず)
```

`tar`コマンドのオプションは以下の通りです。通常のコマンドと違うのは、`-`を付けずにオプションを記入している部分です。

- `t`: アーカイブの内容を表示
- `x`: アーカイブの展開
- `v`: 詳細表示モード(展開されるファイル名などを表示)
- `z`: gzip圧縮されたアーカイブを扱う
- `f`: ファイル名を指定する

今回は使いませんが、`c`オプションを使うとアーカイブの作成ができます。

```{note}
UNIX世界では『アーカイブ』の操作と『圧縮(伸張)』の操作は分けて考えられています。

- `tar`はあくまでアーカイブの作成、展開
- `gzip`や`bzip2`、`xz`は圧縮、伸張

そのため、本来はtarをしてから結果をgzipで処理する(もしくはgzipで伸張したものをtarで展開する)という手順になります。
ただ、面倒なので後年`z`オプション他が追加され、裏で圧縮、伸張を自動的に行うようになりました。

だから今回の展開を旧来の方法で行うと、以下のようになります。
$ gzip -dc latest-ja.tar.gz | tar xv
# ^^^^伸張してstdoutに出力       ^^^ stdinから入ったtarアーカイブを展開
```

## 配置してみる

展開されたwordpressのソースディレクトリを、とりあえずドキュメントルートにおいてみましょう。
まだ動くかはわかりませんが、少なくともPHPのコードを見られるかのチェックとなります。

```bash
$ sudo mv wordpress /var/www/html/

# 所有者をWebサーバーのユーザーに変更(www-data)
$ sudo chown -R www-data:www-data /var/www/html/wordpress
# パーミッションを調整
$ sudo chmod -R 755 /var/www/html/wordpress
```

## ブラウザで確認してみる

ブラウザでアクセスしてみましょう。vscodeのポートにて80番を追加して、マップ先から一旦アクセスし、
URL末尾に`/wordpress`を追加してアクセスしてください。

この時点で2つのことが確認できるはずです。

- WordpressのPHP自体はおそらく解釈されている
- ある事象が原因でまだ先へ進めない
